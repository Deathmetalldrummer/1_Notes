var arch={data:null,init:function(){this._get_local()},_get_local:function(){var t=localStorage.getItem("arch"),e={};t?e=JSON.parse(t):(e.folders=[],e.files=[],e.id_list=[]),this.data=e},_set_local:function(t){t?localStorage.setItem("arch",JSON.stringify(t)):localStorage.setItem("arch",JSON.stringify(this.data)),this.data=JSON.parse(JSON.stringify(this.data))},_create_id:function(){for(var t=this.data.id_list.length,e=0;e<=t;e++)if(-1===this.data.id_list.indexOf(e))return this.data.id_list.push(e),e},_remove_id:function(t){for(var e=this.data.id_list,i=this.findID(t),n=0;n<i.length;n++)e.splice(e.indexOf(i[n]),1)},findID:function(t){var e=this.find(t),i=[],n=[];a(e),function t(e){if(e.folders&&e.folders.length)for(var i=0;i<e.folders.length;i++)n.push(e.folders[i].id),a(e.folders[i]),t(e.folders[i])}(e);var s=i.concat(n);function a(t){if(t.files&&t.files.length)for(var e=0;e<t.files.length;e++)i.push(t.files[e].id)}return s.push(t),s},add:function(t){(t=JSON.parse(JSON.stringify(t))).id=this._create_id();var e=is_Numeric(t.parent_id)?this.find(t.parent_id):this.data;return t.type&&"file"===t.type&&e.files&&e.files.push(t),t.type&&"folder"===t.type&&e.folders&&e.folders.push(t),this._set_local(),t},remove:function(t){if(0===t||0<t){for(var e,i=this.find(t),n=is_Numeric(i.parent_id)?this.find(i.parent_id):this.data,s=0;s<n[i.type+"s"].length;s++)if(n[i.type+"s"][s].id===i.id){e=s;break}this._remove_id(t),n[i.type+"s"].splice(e,1),this._set_local()}},rename:function(t,e){(0===t||0<t)&&(this.find(t).name=e,this._set_local())},find:function(n){var s;return function t(e){if(is_Object(e))for(var i in e.hasOwnProperty("id")&&e.id===n&&(s=e),e)e.hasOwnProperty(i)&&is_Array(e[i])&&e[i].length&&t(e[i]);if(is_Array(e))for(var i=0;i<e.length;i++)t(e[i])}(this.data),s}},menu={_arch:null,_focus:$("#menu .menu__link.menu__focused").length?$("#menu .menu__link.menu__focused"):null,_cacheDom:function(){this.$menu=$("#menu"),this.$li=this.$menu.find(".menu__link"),this.$li_folder=this.$menu.find(".menu__link_folder"),this.$content=$(".drawer__center"),this.sub_menu_class=".menu_sub",this.menu_focused_class="menu__focused",this.menu_link_class="menu__link"},_events:function(){this.$menu.on("click",this._onFocus.bind(this)),$(".menu__link_folder").on("dblclick",this._onCollapse)},_show_content:function(){var t=arch.find(this.focus());t&&"file"===t.type&&this.$content.html(cryptoOut(t.content.html))},_svg_icon:function(t){return"folder"===t?$('<svg class="menu__icon menu__icon_folder" xmlns="http://www.w3.org/2000/svg" viewbox="153 399.8 51 43.2"><path d="M201.6,409.9c-1.3-1.3-2.9-2-4.7-2h-20.2v-1c0-1.8-0.7-3.4-2-4.7c-1.3-1.3-2.9-2-4.7-2h-9.6c-1.8,0-3.4,0.7-4.7,2c-1.3,1.3-2,2.9-2,4.7v28.8c0,1.8,0.7,3.4,2,4.7c1.3,1.3,2.9,2,4.7,2h36.5c1.8,0,3.4-0.7,4.7-2c1.3-1.3,2-2.9,2-4.7v-21.2C203.5,412.8,202.9,411.2,201.6,409.9z M199.7,435.8c0,0.8-0.3,1.5-0.8,2c-0.6,0.6-1.2,0.8-2,0.8h-36.5c-0.8,0-1.5-0.3-2-0.8c-0.6-0.6-0.8-1.2-0.8-2v-28.8c0-0.8,0.3-1.5,0.8-2c0.6-0.6,1.2-0.8,2-0.8h9.6c0.8,0,1.5,0.3,2,0.8c0.6,0.6,0.8,1.2,0.8,2v1.9c0,0.8,0.3,1.5,0.8,2c0.6,0.6,1.2,0.8,2,0.8h21.2c0.8,0,1.5,0.3,2,0.8c0.6,0.6,0.8,1.2,0.8,2L199.7,435.8L199.7,435.8z"></path></svg>'):"file"===t?$('<svg class="menu__icon menu__icon_file" xmlns="http://www.w3.org/2000/svg" viewbox="120 395.1 42.5 51"><path d="M161.4,410.5c-0.4-1-1-1.9-1.6-2.5l-10.2-10.2c-0.6-0.6-1.4-1.1-2.5-1.6c-1-0.4-2-0.7-2.9-0.7h-20.8c-0.9,0-1.6,0.3-2.2,0.9c-0.6,0.6-0.9,1.3-0.9,2.2v43.8c0,0.9,0.3,1.6,0.9,2.2c0.6,0.6,1.3,0.9,2.2,0.9H159c0.9,0,1.6-0.3,2.2-0.9c0.6-0.6,0.9-1.3,0.9-2.2v-29.2C162.1,412.5,161.9,411.5,161.4,410.5z M145.4,400.1c0.6,0.2,1.1,0.5,1.3,0.7L157,411c0.3,0.3,0.5,0.7,0.7,1.3h-12.2V400.1z M157.9,441.5h-33.3v-41.7h16.7v13.5c0,0.9,0.3,1.6,0.9,2.2c0.6,0.6,1.3,0.9,2.2,0.9h13.5V441.5z"></path></svg>'):void 0},_render:function(){var i=$("<div></div>"),n=this;this._arch&&this._arch.folders&&this._arch.folders.length&&$.each(this._arch.folders,function(t,e){i.append(n._menu__li(e))}),this._arch&&this._arch.files&&this._arch.files.length&&$.each(this._arch.files,function(t,e){i.append(n._menu__li(e))}),this.$menu.html(i.html()),this._events()},_menu__li:function(t){var i=this,e=$("#menu .menu__link.menu__focused").data("id")===t.id?" menu__focused":"",n=$('<li class="menu__ menu__'+t.type+'"></li>'),s=$('<a class="menu__link menu__link_'+t.type+e+'" data-id='+t.id+' href="#">'+t.name+"</a>");s.prepend(menu._svg_icon(t.type)),n.append(s);var a=$('<ul class="menu_sub"></ul>');return t.folders&&t.folders.length&&$.each(t.folders,function(t,e){a.append(i._menu__li(e))}),t.files&&t.files.length&&$.each(t.files,function(t,e){a.append(i._menu__li(e))}),a.html()||(a=""),n.append(a),n},init:function(){this._arch=arch.data,this._cacheDom(),this._render()},add:function(){this._arch=JSON.parse(localStorage.getItem("arch")),this._render()},remove:function(){this._arch=JSON.parse(localStorage.getItem("arch")),this._focus=null,this._render()},rename:function(){this._arch=JSON.parse(localStorage.getItem("arch")),this._focus=null,this._render()},_onFocus:function(t){$(t.target).hasClass(this.menu_link_class)||$(t.target).closest("."+this.menu_link_class)?(this.$menu.find("."+this.menu_focused_class).removeClass(this.menu_focused_class),this._focus=$(t.target).closest("."+this.menu_link_class),this._focus.addClass(this.menu_focused_class),this._show_content(t)):(this._focus=null,this.$menu.find("."+this.menu_focused_class).removeClass(this.menu_focused_class))},_onCollapse:function(){$(this).siblings(this.sub_menu_class).slideToggle()},focus:function(){return this._focus?this._focus.data("id"):null}},de={init:function(){this.cacheDom(),this.events()},cacheDom:function(){this.$de=$(".directory_edit"),this.$edit=this.$de.find(".de__edit_"),this.$check=this.$de.find(".de__check_"),this.$tabs_content=$("#tabs_content"),this.$textarea_html=this.$tabs_content.find(".tabs__html textarea"),this.$textarea_md=this.$tabs_content.find(".tabs__md textarea")},events:function(){this.$edit.on("click",this.editFile.bind(this)),this.$check.on("click",this.checkFile.bind(this))},editFile:function(){var t=arch.find(menu.focus());this.$tabs_content.addClass("edit"),t&&"file"===t.type&&(this.$textarea_html.val(cryptoOut(t.content.html)),this.$textarea_md.val(cryptoOut(t.content.md)),arch._set_local())},checkFile:function(){if(this.$tabs_content.hasClass("edit")){var t=arch.find(menu.focus());t&&"file"===t.type&&(t.content.html=cryptoIn(this.$textarea_html.val()),t.content.md=cryptoIn(this.$textarea_md.val()),this.$tabs_content.removeClass("edit"),this.$textarea_html.val(""),this.$textarea_md.val(""),menu._show_content(),arch._set_local())}}},dm={init:function(){this.cacheDom(),this.events()},cacheDom:function(){this.$dm=$(".directory_management"),this.$add_file=this.$dm.find(".dm__add_file"),this.$add_folder=this.$dm.find(".dm__add_folder"),this.$remove=this.$dm.find(".dm__edit_remove"),this.$edit=this.$dm.find(".dm__edit_edit")},events:function(){this.$add_file.on("click",nn.addIdFile.bind(nn)),this.$add_folder.on("click",nn.addIdFolder.bind(nn)),this.$remove.on("click",this.remove.bind(this)),this.$edit.on("click",this.rename.bind(this))},remove:function(){var t=menu.focus();arch.remove(t),menu.remove()},rename:function(){(0===menu.focus()||0<menu.focus())&&nn.typeRename()}},nn={init:function(){this.cacheDom(),this.events()},cacheDom:function(){this.$newName=$("#new_name"),this.$input=this.$newName.find(".nn__input"),this.$submit=this.$newName.find(".nn__submit"),this.$cancel=this.$newName.find(".nn__cancel")},events:function(){this.$cancel.on("click",this.cancel.bind(this)),this.$submit.on("click",this.submit.bind(this))},cancel:function(){this.$newName.addClass("nn__hide"),this.$newName.removeAttr("data-type"),this.$input.val("")},submit:function(){var t=this.$newName.attr("data-type");"file"===t&&this.addFile(),"folder"===t&&this.addFolder(),"rename"===t&&this.rename(),this.cancel()},addFile:function(){var t=new file({parent_id:menu.focus(),name:this.$input.val()});menu.add(arch.add(t))},addFolder:function(){var t=new folder({parent_id:menu.focus(),name:this.$input.val()});menu.add(arch.add(t))},rename:function(){var t=menu.focus();arch.rename(t,this.$input.val()),menu.rename()},addIdFile:function(){this.$newName.attr("data-type","file"),this.$newName.removeClass("nn__hide")},addIdFolder:function(){this.$newName.attr("data-type","folder"),this.$newName.removeClass("nn__hide")},typeRename:function(){this.$newName.attr("data-type","rename"),this.$newName.removeClass("nn__hide")}},tabs={init:function(){this._cacheDom(),this._events()},_cacheDom:function(){this.$links=$("#tabs_link"),this.$link_tab=this.$links.find(".tabs__"),this.$content=$("#tabs_content"),this.$content_html=this.$content.find(".tabs__html"),this.$content_md=this.$content.find(".tabs__md"),this.active_class="tabs_active"},_events:function(){this.$links.on("click",this._active_toggle.bind(this))},_active_toggle:function(t){this.target=$(t.target),this.target.hasClass("tabs__")&&!this.target.hasClass(this.active_class)&&(this.target.addClass(this.active_class).siblings(".tabs_active").removeClass(this.active_class),this.target.hasClass("tabs__html")&&this.$content_html.addClass(this.active_class).siblings("."+this.active_class).removeClass(this.active_class),this.target.hasClass("tabs__md")&&this.$content_md.addClass(this.active_class).siblings("."+this.active_class).removeClass(this.active_class))}};function folder(t){this.type="folder",this.name=t.name||"Folder name",this.desc=t.desc||"Folder desc",this.image=t.image||"Folder image",this.folders=t.folders||[],this.files=t.files||[],this.parent_id=t.parent_id}function file(t){this.type="file",this.name=t.name||"File name",this.desc=t.desc||"File desc",this.image=t.image||"File image",this.content={html:t.html||"PGgxPkhlbGxvLHdvcmxkITwvaDE+",md:t.md||"IyBIZWxsbyx3b3JsZCE="},this.parent_id=t.parent_id}function is_Object(t){return $.isPlainObject(t)}function is_Array(t){return $.isArray(t)}function is_Numeric(t){return $.isNumeric(t)}function cryptoIn(t){return utf8_to_b64(t)}function cryptoOut(t){return b64_to_utf8(t)}function utf8_to_b64(t){return window.btoa(unescape(encodeURIComponent(t)))}function b64_to_utf8(t){return decodeURIComponent(escape(window.atob(t)))}$(document).ready(function(){$.ajax({url:"./arch.json",success:function(t){localStorage.getItem("arch")||localStorage.setItem("arch",JSON.stringify(t))},error:function(){console.log("Cорян,тут ничё нету.")},complete:function(){arch.init(),menu.init(),tabs.init(),dm.init(),de.init(),nn.init(),$(".drawer__toggle_left").on("click",function(){$(".drawers").toggleClass("drawer__opened_left")}),$(".drawer__toggle_right").on("click",function(){$(".drawers").toggleClass("drawer__opened_right")})}})});